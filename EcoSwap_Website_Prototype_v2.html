<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>EcoSwap â€” Prototype (v2)</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&display=swap" rel="stylesheet">
  <style>
    :root{
      --primary:#2ECC71;
      --dark:#1E824C;
      --light:#D4EFDF;
      --bg:#F7F9F9;
      --surface:#ffffff;
      --muted:#6B7280;
      --radius:12px;
      --shadow: 0 6px 18px rgba(15,23,42,0.06);
      --focus: 0 0 0 4px rgba(46,204,113,0.12);
    }
    *{box-sizing:border-box}
    html,body{height:100%;margin:0;font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,'Helvetica Neue',Arial;color:#222;background:var(--bg);-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale}
    a{color:inherit;text-decoration:none}
    :focus{outline:none;box-shadow:var(--focus);border-radius:8px}

    /* Layout */
    .container{max-width:1100px;margin:28px auto;padding:0 20px}
    header{display:flex;align-items:center;justify-content:space-between;padding:18px 0}
    .logo{display:flex;align-items:center;gap:12px}
    .logo .mark{width:44px;height:44px;border-radius:10px;background:linear-gradient(135deg,var(--primary),var(--dark));display:flex;align-items:center;justify-content:center;color:#fff;font-weight:800}
    nav{display:flex;gap:18px;align-items:center}
    .btn{background:var(--primary);color:#fff;padding:10px 16px;border-radius:10px;border:none;cursor:pointer;font-weight:600}
    .ghost{background:transparent;padding:8px 12px;border-radius:8px;border:1px solid rgba(0,0,0,0.06);cursor:pointer}

    /* Hero */
    .hero{display:grid;grid-template-columns:1fr 420px;gap:28px;align-items:center;margin-top:24px}
    .hero h1{font-size:36px;margin:0;line-height:1.05}
    .hero p{color:var(--muted);margin-top:10px}
    .hero .cta{margin-top:18px}
    .hero-illustration{background:linear-gradient(180deg,var(--light),#fff);border-radius:16px;padding:28px;box-shadow:var(--shadow);display:flex;align-items:center;justify-content:center;min-height:220px}

    /* categories */
    .categories{display:flex;gap:12px;margin:28px 0;flex-wrap:wrap}
    .cat{background:var(--surface);padding:18px;border-radius:12px;flex:1;box-shadow:var(--shadow);display:flex;gap:12px;align-items:center;min-width:180px}
    .cat .icon{width:56px;height:56px;border-radius:12px;background:var(--light);display:flex;align-items:center;justify-content:center;font-weight:700}

    /* Grid */
    .grid{display:grid;grid-template-columns:repeat(3,1fr);gap:18px}
    .card{background:var(--surface);border-radius:12px;padding:14px;box-shadow:var(--shadow);display:flex;flex-direction:column;gap:8px}
    .card img{width:100%;height:150px;object-fit:cover;border-radius:8px}
    .card h3{margin:0;font-size:16px}
    .card p{margin:0;color:var(--muted);font-size:14px}
    .card .actions{display:flex;gap:8px;margin-top:auto}
    .secondary{background:var(--dark);color:#fff;padding:8px 12px;border-radius:10px;border:none}
    .muted{color:var(--muted)}

    /* Item Details */
    .details{display:grid;grid-template-columns:1fr 360px;gap:24px}
    .details .meta{background:var(--surface);padding:18px;border-radius:12px;box-shadow:var(--shadow)}
    .btn-block{display:flex;gap:12px}
    .tag{display:inline-block;background:var(--light);padding:6px 10px;border-radius:999px;font-weight:600}

    /* Forms */
    label{display:block;margin-bottom:6px;font-weight:600}
    input,select,textarea{width:100%;padding:10px;border-radius:10px;border:1px solid #E6E9EE;background:#fff;font-size:14px}
    input[type=file]{padding:6px}
    textarea{min-height:120px;resize:vertical}
    .form-row{display:grid;grid-template-columns:1fr 1fr;gap:12px}

    /* Profile / Dashboard */
    .profile{display:grid;grid-template-columns:260px 1fr;gap:18px}
    .card-stat{padding:16px;border-radius:12px;background:var(--surface);box-shadow:var(--shadow);display:flex;flex-direction:column;gap:6px}
    .stat-grid{display:grid;grid-template-columns:repeat(3,1fr);gap:12px;margin-top:12px}

    /* Impact */
    .stats{display:flex;gap:12px;flex-wrap:wrap}
    .badge{padding:8px 12px;border-radius:999px;background:var(--light);display:inline-block;font-weight:600}

    /* Footer */
    footer{margin-top:36px;padding:18px 0;color:var(--muted);display:flex;justify-content:space-between;align-items:center;flex-wrap:wrap;gap:8px}

    /* Responsive */
    @media (max-width:900px){
      .hero{grid-template-columns:1fr}
      .grid{grid-template-columns:repeat(2,1fr)}
      .details{grid-template-columns:1fr}
      .container{padding:0 16px}
      .profile{grid-template-columns:1fr}
      .form-row{grid-template-columns:1fr}
    }
    @media (max-width:560px){
      .grid{grid-template-columns:1fr}
    }

    /* modal */
    .modal-backdrop{position:fixed;inset:0;background:rgba(0,0,0,0.4);display:none;align-items:center;justify-content:center;z-index:1200}
    .modal{background:#fff;padding:20px;border-radius:12px;width:420px;box-shadow:var(--shadow)}
    .show{display:flex}
    .sr-only{position:absolute;width:1px;height:1px;padding:0;margin:-1px;overflow:hidden;clip:rect(0,0,0,0);white-space:nowrap;border:0}

    /* tiny helpers */
    .center{text-align:center}
    .right{text-align:right}
    .clickable{cursor:pointer}
  </style>
</head>
<body>
  <div class="container" role="main">
    <header>
      <div class="logo" aria-label="EcoSwap logo">
        <div class="mark" aria-hidden="true">ES</div>
        <div>
          <strong>EcoSwap</strong>
          <div style="font-size:12px;color:var(--muted)">SDG 12 â€¢ Responsible Consumption</div>
        </div>
      </div>

      <nav aria-label="Main navigation">
        <a href="#home">Home</a>
        <a href="#browse">Browse</a>
        <a href="#add">Add Item</a>
        <a href="#impact">Impact</a>
        <button class="btn" onclick="openLogin()" id="loginBtn" aria-haspopup="dialog">Log in</button>
      </nav>
    </header>

    <!-- HOME / HERO -->
    <section id="home" class="hero" aria-labelledby="hero-title">
      <div>
        <h1 id="hero-title">EcoSwap â€” Swap. Share. Save.</h1>
        <p>Reduce waste and save money by swapping and borrowing school items within your campus community.</p>
        <div class="cta"><button class="btn" onclick="goTo('#browse')">Browse Items</button></div>
        <div class="categories" role="list" aria-label="Categories">
          <div class="cat" role="listitem"><div class="icon" aria-hidden="true">ðŸ“š</div><div><strong>School Items</strong><div class="muted">Calculators, supplies</div></div></div>
          <div class="cat" role="listitem"><div class="icon" aria-hidden="true">ðŸ“–</div><div><strong>Books</strong><div class="muted">Textbooks & references</div></div></div>
          <div class="cat" role="listitem"><div class="icon" aria-hidden="true">ðŸ”Œ</div><div><strong>Gadgets</strong><div class="muted">Chargers, headphones</div></div></div>
          <div class="cat" role="listitem"><div class="icon" aria-hidden="true">ðŸŽ½</div><div><strong>Uniforms</strong><div class="muted">Pre-loved uniforms</div></div></div>
        </div>
      </div>
      <div class="hero-illustration" aria-hidden="true">
        <svg width="100%" height="260" viewBox="0 0 600 260" xmlns="http://www.w3.org/2000/svg" role="img" aria-label="Illustration of swapping items">
          <rect x="10" y="20" rx="16" ry="16" width="220" height="220" fill="#fff" stroke="#E8F8EE" stroke-width="1"/>
          <rect x="180" y="40" rx="14" ry="14" width="380" height="180" fill="#fff" stroke="#E8F8EE" />
          <g transform="translate(240,90)"><text font-size="22" fill="#2ECC71" font-weight="700">Swap</text><text x="0" y="36" font-size="18" fill="#6B7280">Share items. Save money.</text></g>
        </svg>
      </div>
    </section>

    <!-- BROWSE -->
    <section id="browse" aria-labelledby="browse-title">
      <h2 id="browse-title" style="margin-top:28px">Browse Items</h2>
      <div style="display:flex;gap:12px;margin:12px 0;align-items:center">
        <input id="q" aria-label="Search items" placeholder="Search items..." style="flex:1;padding:12px;border-radius:10px;border:1px solid #E6E9EE" />
        <select id="filterCategory" aria-label="Filter category" style="padding:10px;border-radius:10px;border:1px solid #E6E9EE"><option value="all">All</option><option value="books">Books</option><option value="gadgets">Gadgets</option><option value="school">School Items</option><option value="uniforms">Uniforms</option></select>
        <button class="ghost" onclick="filterItems()">Filter</button>
      </div>

      <div class="grid" id="itemsGrid" aria-live="polite"></div>
    </section>

    <!-- ITEM DETAILS TEMPLATE (hidden) -->
    <template id="itemTemplate">
      <article class="card" role="article" aria-label="item-card">
        <img src="" alt="item photo" />
        <h3 tabindex="0"></h3>
        <p class="muted"></p>
        <div class="actions">
          <button class="ghost" onclick="openBorrow(this)" aria-label="Borrow this item">Borrow</button>
          <button class="btn" onclick="openSwap(this)" aria-label="Swap for this item">Swap</button>
        </div>
      </article>
    </template>

    <!-- DETAILS PAGE -->
    <section id="details" style="display:none;margin-top:28px" aria-labelledby="details-title">
      <div class="details">
        <div>
          <div class="card" id="detailsCard">
            <img id="detailsImg" src="" alt="Item image" style="height:320px" />
            <h3 id="detailsTitle"></h3>
            <p id="detailsOwner" class="muted"></p>
            <div style="margin-top:12px;padding:12px;border-radius:12px;background:var(--surface);box-shadow:var(--shadow)">
              <p><strong>Condition:</strong> <span id="detailsCondition"></span></p>
              <p><strong>Category:</strong> <span id="detailsCategory"></span></p>
              <p id="detailsDescription" style="margin-top:8px;color:var(--muted)"></p>
            </div>
          </div>
        </div>
        <div class="meta">
          <div class="card-stat">
            <strong>Actions</strong>
            <div style="margin-top:10px" class="btn-block">
              <button class="btn" onclick="openSwap()">Swap Item</button>
              <button class="secondary" onclick="openBorrow()">Borrow Item</button>
            </div>
          </div>
          <div class="card-stat">
            <strong>Owner Info</strong>
            <p class="muted" id="ownerInfo">@mika â€¢ Senior High</p>
          </div>
        </div>
      </div>
    </section>

    <!-- SWAP FORM -->
    <section id="swapFormSection" style="display:none;margin-top:28px" aria-labelledby="swap-title">
      <h2 id="swap-title">Swap Request</h2>
      <div style="display:grid;grid-template-columns:1fr 1fr;gap:18px">
        <div class="card">
          <h3>Your Item Preview</h3>
          <div id="swapPreview" style="height:140px;background:#fff;border-radius:10px;border:1px dashed #E6E9EE;display:flex;align-items:center;justify-content:center">No photo</div>
          <label class="sr-only" for="swapPhoto">Upload photo for swap</label>
          <input type="file" id="swapPhoto" accept="image/*" />
        </div>
        <div class="card">
          <label for="swapTitle">Your Item Title</label>
          <input id="swapTitle" aria-required="true" />
          <label style="margin-top:10px" for="swapCondition">Condition</label>
          <select id="swapCondition"><option>Like New</option><option>Good</option><option>Fair</option></select>
          <label style="margin-top:10px" for="swapNotes">Notes to Owner</label>
          <textarea id="swapNotes" placeholder="Eg. Available for pickup at the library"></textarea>
          <div style="margin-top:12px"><button class="btn" onclick="submitSwap()">Submit Swap Request</button></div>
        </div>
      </div>
    </section>

    <!-- BORROW FORM -->
    <section id="borrowFormSection" style="display:none;margin-top:28px" aria-labelledby="borrow-title">
      <h2 id="borrow-title">Borrow Item</h2>
      <div class="card">
        <label for="borrowDuration">Duration</label>
        <select id="borrowDuration"><option>1 day</option><option>3 days</option><option>1 week</option></select>
        <label style="margin-top:10px" for="borrowMessage">Message to Owner</label>
        <textarea id="borrowMessage" placeholder="Eg. I can pick up on Monday after class"></textarea>
        <div style="margin-top:12px"><button class="btn" onclick="submitBorrow()">Send Borrow Request</button></div>
      </div>
    </section>

    <!-- ADD ITEM -->
    <section id="add" style="margin-top:28px" aria-labelledby="add-title">
      <h2 id="add-title">Add Item To EcoSwap</h2>
      <div style="display:grid;grid-template-columns:1fr 1fr;gap:18px;margin-top:12px">
        <div class="card">
          <label for="newPhoto">Upload Photo</label>
          <div style="height:220px;background:#fff;border-radius:10px;border:1px dashed #E6E9EE;display:flex;align-items:center;justify-content:center" id="photoPreview">No image</div>
          <input type="file" id="newPhoto" accept="image/*" aria-label="Upload item photo" />
          <label style="margin-top:10px" for="newTitle">Title</label>
          <input id="newTitle" aria-required="true" />
          <label style="margin-top:10px" for="newCategory">Category</label>
          <select id="newCategory"><option>School Items</option><option>Books</option><option>Gadgets</option><option>Uniforms</option></select>
        </div>
        <div class="card">
          <label for="newCondition">Condition</label>
          <select id="newCondition"><option>Like New</option><option>Good</option><option>Fair</option></select>
          <label style="margin-top:10px" for="newDesc">Description</label>
          <textarea id="newDesc" placeholder="Add details to help others decide"></textarea>
          <div style="margin-top:12px"><button class="btn" onclick="postNewItem()">Post Item</button></div>
        </div>
      </div>
    </section>

    <!-- PROFILE / DASHBOARD -->
    <section id="profile" style="margin-top:28px" aria-labelledby="dashboard-title">
      <h2 id="dashboard-title">Dashboard</h2>
      <div class="profile" style="margin-top:12px">
        <div>
          <div class="card" style="display:flex;flex-direction:column;align-items:center;gap:12px;padding:20px">
            <div style="width:96px;height:96px;border-radius:999px;background:linear-gradient(135deg,var(--primary),var(--dark));display:flex;align-items:center;justify-content:center;color:#fff;font-weight:800;font-size:28px" id="userInitials">SN</div>
            <div><strong id="userFullName">Guest</strong><div class="muted" id="userHandle">@guest</div></div>
          </div>
          <div style="margin-top:12px" class="card">
            <strong>Menu</strong>
            <ul style="list-style:none;padding:0;margin:12px 0;display:flex;flex-direction:column;gap:8px">
              <li><a href="#myItems" id="menuMyItems">My Items</a></li>
              <li><a href="#swaps">Completed Swaps</a></li>
              <li><a href="#favorites">Favorites</a></li>
              <li><a href="#settings" id="menuSettings">Settings</a></li>
            </ul>
          </div>
        </div>
        <div>
          <div class="card-stat">
            <strong>EcoScore</strong>
            <div style="font-size:28px;color:var(--primary)" id="ecoScore">0</div>
            <div class="muted" id="ecoSub">You saved 0 items from waste</div>
          </div>

          <div class="stat-grid">
            <div class="card-stat"><strong>Recent Swaps</strong><p class="muted" id="recentSwaps">â€”</p></div>
            <div class="card-stat"><strong>Items Posted</strong><p class="muted" id="itemsPosted">0 active listings</p></div>
            <div class="card-stat"><strong>Money Saved</strong><p class="muted" id="moneySaved">â‚±0</p></div>
          </div>

        </div>
      </div>
    </section>

    <!-- IMPACT -->
    <section id="impact" style="margin-top:28px" aria-labelledby="impact-title">
      <h2 id="impact-title">My Impact</h2>
      <div style="margin-top:12px;display:flex;gap:12px;flex-wrap:wrap">
        <div class="card-stat" style="flex:1"><strong>Items Swapped</strong><div style="font-size:24px;color:var(--primary)" id="statSwapped">0</div></div>
        <div class="card-stat" style="flex:1"><strong>Money Saved</strong><div style="font-size:24px;color:var(--primary)" id="statMoney">â‚±0</div></div>
        <div class="card-stat" style="flex:1"><strong>Waste Reduced</strong><div style="font-size:24px;color:var(--primary)" id="statWaste">0 kg</div></div>
      </div>
      <div style="margin-top:18px">
        <strong>Achievements</strong>
        <div style="display:flex;gap:8px;margin-top:10px;flex-wrap:wrap">
          <div class="badge">Eco Beginner</div>
          <div class="badge">Eco Saver</div>
          <div class="badge">Eco Hero</div>
        </div>
      </div>
    </section>

    <footer>
      <div>&copy; 2025 EcoSwap â€¢ SDG 12 Responsible Consumption</div>
      <div class="muted">Made for HCI class â€¢ Prototype</div>
    </footer>
  </div>

  <!-- modal backdrop -->
  <div id="modal" class="modal-backdrop" role="dialog" aria-modal="true" aria-hidden="true">
    <div class="modal" id="modalContent" tabindex="-1"></div>
  </div>

  <script>
    /* -------------------------------
       Utilities & Persistence
       ------------------------------- */
    const STORAGE_KEY = 'ecoswap_v2_items';
    const USER_KEY = 'ecoswap_v2_user';

    function loadItems(){
      const raw = localStorage.getItem(STORAGE_KEY);
      if(!raw) {
        const seed = [
          {id:1,title:'Scientific Calculator',cat:'school',cond:'Good',owner:'@mika',img:'https://images.unsplash.com/photo-1581093588401-8f39fa8b2f17?auto=format&fit=crop&w=800&q=60',desc:'Casio fx-991ES, works perfectly.'},
          {id:2,title:'Biology Textbook',cat:'books',cond:'Like New',owner:'@arlo',img:'https://images.unsplash.com/photo-1513475382585-d06e58bcb0ea?auto=format&fit=crop&w=800&q=60',desc:'Complete edition for senior high.'},
          {id:3,title:'Art Set',cat:'school',cond:'Good',owner:'@rhal',img:'https://images.unsplash.com/photo-1496317899792-9d7dbcd928a1?auto=format&fit=crop&w=800&q=60',desc:'Watercolors + brushes, light use.'},
          {id:4,title:'Headphones',cat:'gadgets',cond:'Fair',owner:'@jerome',img:'https://images.unsplash.com/photo-1518444022131-8a8f5a5e5b4a?auto=format&fit=crop&w=800&q=60',desc:'Over-ear headphones, slight wear.'}
        ];
        localStorage.setItem(STORAGE_KEY, JSON.stringify(seed));
        return seed;
      }
      try { return JSON.parse(raw); } catch(e){ return []; }
    }

    function saveItems(list){ localStorage.setItem(STORAGE_KEY, JSON.stringify(list)); }

    function loadUser(){
      const raw = localStorage.getItem(USER_KEY);
      if(!raw) return null;
      try { return JSON.parse(raw); } catch(e){ return null; }
    }
    function saveUser(u){ localStorage.setItem(USER_KEY, JSON.stringify(u)); }

    /* -------------------------------
       App State
       ------------------------------- */
    let items = loadItems();
    let currentUser = loadUser() || {name:'Guest', handle:'@guest', initials:'GN', ecoScore:0};

    // DOM refs
    const itemsGrid = document.getElementById('itemsGrid');
    const template = document.getElementById('itemTemplate');
    const qInput = document.getElementById('q');
    const filterSelect = document.getElementById('filterCategory');

    /* -------------------------------
       Rendering
       ------------------------------- */
    function renderItems(list = items){
      itemsGrid.innerHTML = '';
      if(list.length === 0){ itemsGrid.innerHTML = '<div class="muted">No items found.</div>'; return; }
      list.forEach(it => {
        const node = template.content.cloneNode(true);
        const img = node.querySelector('img');
        img.src = it.img;
        img.alt = it.title;
        node.querySelector('h3').innerText = it.title;
        node.querySelector('p').innerText = it.owner + ' â€¢ ' + it.cond;
        node.querySelector('.ghost').onclick = () => openBorrowById(it.id);
        node.querySelector('.btn').onclick = () => openSwapById(it.id);
        node.querySelector('img').onclick = () => openDetailsById(it.id);
        node.querySelector('h3').onclick = () => openDetailsById(it.id);
        itemsGrid.appendChild(node);
      })
    }

    function renderDashboard(){
      document.getElementById('userFullName').innerText = currentUser.name || 'Guest';
      document.getElementById('userHandle').innerText = currentUser.handle || '@guest';
      document.getElementById('userInitials').innerText = currentUser.initials || 'GN';
      const posted = items.filter(i => i.owner === currentUser.handle).length;
      const swapped = Math.floor(Math.random()*20); // placeholder for demo
      document.getElementById('itemsPosted').innerText = posted + ' active listings';
      document.getElementById('recentSwaps').innerText = swapped ? 'Calculator â€¢ Borrowed â€¢ Completed' : 'â€”';
      document.getElementById('ecoScore').innerText = currentUser.ecoScore || 0;
      document.getElementById('ecoSub').innerText = `You saved ${Math.floor((currentUser.ecoScore||0)/3)} items from waste`;
      document.getElementById('statSwapped').innerText = swapped;
      document.getElementById('statMoney').innerText = 'â‚±' + ((swapped*50).toFixed(0));
      document.getElementById('statWaste').innerText = (swapped*0.3).toFixed(1) + ' kg';
      document.getElementById('statSwapped').setAttribute('aria-live','polite');
      document.getElementById('itemsPosted').setAttribute('aria-live','polite');
    }

    /* -------------------------------
       Search + Filter (with debounce)
       ------------------------------- */
    let searchTimer = null;
    qInput.addEventListener('input', ()=>{
      clearTimeout(searchTimer);
      searchTimer = setTimeout(()=>filterItems(), 300);
    });
    filterSelect.addEventListener('change', filterItems);

    function filterItems(){
      const q = qInput.value.trim().toLowerCase();
      const cat = filterSelect.value;
      const filtered = items.filter(it => (cat==='all' || it.cat === cat) && (it.title.toLowerCase().includes(q) || it.desc.toLowerCase().includes(q) || it.owner.toLowerCase().includes(q)));
      renderItems(filtered);
    }

    /* -------------------------------
       Navigation & Views
       ------------------------------- */
    function hideAll(){ document.querySelectorAll('section').forEach(s=>s.style.display='none'); }
    function goTo(id){
      hideAll();
      const el = document.querySelector(id);
      if(el) el.style.display='block';
      window.scrollTo({top:0,behavior:'smooth'});
      // update URL hash for navigation history
      if(location.hash !== id) history.pushState(null, '', id);
      // update ARIA
      document.getElementById('modal').setAttribute('aria-hidden','true');
      renderDashboard();
    }

    // set initial view
    document.querySelectorAll('section').forEach(s=>{ if(!s.id || s.id==='home') s.style.display='block'; else s.style.display='none' });

    window.addEventListener('popstate', ()=>{
      const hash = location.hash || '#home';
      goTo(hash);
    });

    /* -------------------------------
       Details & Forms
       ------------------------------- */
    function openDetailsById(id){
      const it = items.find(x=>x.id===id);
      if(!it) return;
      document.getElementById('detailsImg').src = it.img;
      document.getElementById('detailsTitle').innerText = it.title;
      document.getElementById('detailsOwner').innerText = it.owner;
      document.getElementById('detailsCondition').innerText = it.cond;
      document.getElementById('detailsCategory').innerText = it.cat;
      document.getElementById('detailsDescription').innerText = it.desc;
      goTo('#details');
    }
    function openSwapById(id){ openDetailsById(id); openSwap(); }
    function openBorrowById(id){ openDetailsById(id); openBorrow(); }
    function openSwap(){ goTo('#swapFormSection'); }
    function openBorrow(){ goTo('#borrowFormSection'); }

    // Swap image preview
    document.getElementById('swapPhoto').addEventListener('change', (e)=>{
      const file = e.target.files[0];
      if(!file) return;
      const reader = new FileReader();
      reader.onload = ()=>{ document.getElementById('swapPreview').innerHTML = `<img src="${reader.result}" alt="preview" style="max-width:100%;max-height:140px;border-radius:8px" />`; }
      reader.readAsDataURL(file);
    });

    // New item preview
    document.getElementById('newPhoto').addEventListener('change', (e)=>{
      const file = e.target.files[0];
      const preview = document.getElementById('photoPreview');
      if(!file){ preview.innerText = 'No image'; return; }
      const reader = new FileReader();
      reader.onload = ()=>{ preview.innerHTML = `<img src="${reader.result}" alt="item preview" style="max-width:100%;max-height:200px;border-radius:8px" />`; }
      reader.readAsDataURL(file);
    });

    /* -------------------------------
       Submit handlers & validations
       ------------------------------- */
    function submitSwap(){
      const title = document.getElementById('swapTitle').value.trim();
      if(!title){ showModal('Error','Please enter a title for your swap item.'); return; }
      showModal('Request Sent Successfully!','Your swap request has been sent to the owner.');
    }
    function submitBorrow(){
      const msg = document.getElementById('borrowMessage').value.trim();
      if(!msg){ showModal('Validation','Please include a short message to the owner.'); return; }
      showModal('Borrow Request Sent!','The owner will review your request.');
    }

    function postNewItem(){
      const title = document.getElementById('newTitle').value.trim();
      const cat = document.getElementById('newCategory').value.toLowerCase().replace(' ', '');
      const cond = document.getElementById('newCondition').value;
      const desc = document.getElementById('newDesc').value.trim();
      const fileInput = document.getElementById('newPhoto');
      if(!title){ showModal('Validation','Please add a title.'); return; }
      // try to get preview image dataURL if present (for demo)
      if(fileInput.files && fileInput.files[0]){
        const reader = new FileReader();
        reader.onload = ()=>{ saveNewItem(title, cat, cond, desc, reader.result); }
        reader.readAsDataURL(fileInput.files[0]);
      } else {
        // fallback to placeholder image
        saveNewItem(title, cat, cond, desc, 'https://images.unsplash.com/photo-1512496015851-a90fb38ba796?auto=format&fit=crop&w=800&q=60');
      }
    }

    function saveNewItem(title, cat, cond, desc, img){
      const newId = items.length ? Math.max(...items.map(i=>i.id))+1 : 1;
      const ownerHandle = currentUser.handle || '@guest';
      const newItem = {id:newId,title:title,cat:cat,cond:cond,owner:ownerHandle,img:img,desc:desc};
      items.unshift(newItem);
      saveItems(items);
      showModal('Item Posted','Your item is now visible in the marketplace.');
      goTo('#browse');
      renderItems();
    }

    /* -------------------------------
       Modal & UI helpers
       ------------------------------- */
    function showModal(title, text){
      const modal = document.getElementById('modal');
      const content = document.getElementById('modalContent');
      content.innerHTML = `<h3>${title}</h3><p class="muted">${text}</p><div style="margin-top:12px;text-align:right"><button class="btn" onclick="closeModal()">OK</button></div>`;
      modal.classList.add('show');
      modal.setAttribute('aria-hidden','false');
      // focus inside modal for accessibility
      setTimeout(()=>{ document.getElementById('modalContent').focus(); }, 50);
    }
    function closeModal(){ const modal = document.getElementById('modal'); modal.classList.remove('show'); modal.setAttribute('aria-hidden','true'); }

    /* -------------------------------
       Simple mock login (client-side only)
       ------------------------------- */
    function openLogin(){
      const modal = document.getElementById('modal');
      const content = document.getElementById('modalContent');
      content.innerHTML = `
        <h3>Quick Login (Demo)</h3>
        <p class="muted">Sign in with your name to personalize the prototype.</p>
        <label for="loginName">Full name</label>
        <input id="loginName" placeholder="e.g., Stephen Nash" style="margin-top:6px" />
        <label style="margin-top:10px">Username (handle)</label>
        <input id="loginHandle" placeholder="@stephen" />
        <div style="margin-top:12px;text-align:right">
          <button class="ghost" onclick="closeModal()">Cancel</button>
          <button class="btn" onclick="submitLogin()" style="margin-left:8px">Sign in</button>
        </div>
      `;
      modal.classList.add('show');
      modal.setAttribute('aria-hidden','false');
      setTimeout(()=>document.getElementById('loginName').focus(),50);
    }
    function submitLogin(){
      const name = document.getElementById('loginName').value.trim();
      const handle = document.getElementById('loginHandle').value.trim() || '@' + (name.split(' ')[0]||'user').toLowerCase();
      if(!name){ alert('Please enter your name'); return; }
      currentUser = {name:name, handle:handle, initials: name.split(' ').map(n=>n[0]).slice(0,2).join('').toUpperCase(), ecoScore: Math.floor(Math.random()*80)+10};
      saveUser(currentUser);
      document.getElementById('loginBtn').innerText = 'Account';
      closeModal();
      renderDashboard();
      showModal('Welcome', `Hi ${name}! You're signed in as ${handle}.`);
    }

    /* -------------------------------
       Initialization
       ------------------------------- */
    renderItems();
    renderDashboard();

    // keyboard: close modal with ESC
    document.addEventListener('keydown', (e)=>{ if(e.key === 'Escape') closeModal(); });

  </script>
</body>
</html>
